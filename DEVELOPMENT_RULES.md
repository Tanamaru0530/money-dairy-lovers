# Money Dairy Lovers 開発ルール

## 1. 変更時の影響調査ルール

### 1.1 API/サービス層の変更時
- **必須チェック項目**：
  1. 該当サービスを使用している全てのコンポーネントを検索（`grep -r "サービス名" frontend/src`）
  2. 返り値の型が変更される場合、TypeScriptのコンパイルエラーを確認
  3. APIのレスポンス形式が変更される場合、全ての呼び出し箇所を修正

- **チェックリスト**：
  - [ ] サービスの返り値の型を変更した場合、全ての使用箇所を確認
  - [ ] APIエンドポイントのURLを変更した場合、全ての呼び出し箇所を修正
  - [ ] レスポンスの構造を変更した場合（例：配列 → オブジェクト）、全ての参照を修正

### 1.2 型定義の変更時
- **必須チェック項目**：
  1. 変更した型を使用している全てのファイルを検索
  2. 型の継承関係を確認（extends している型も影響を受ける）
  3. ジェネリック型として使用されている箇所も確認

### 1.3 コンポーネントの変更時
- **必須チェック項目**：
  1. プロップスの変更がある場合、全ての使用箇所を確認
  2. 共通コンポーネントの場合、プロジェクト全体で検索
  3. スタイルの変更がある場合、他のコンポーネントへの影響を確認

## 2. 実装前の確認事項

### 2.1 変更前チェックリスト
```bash
# 1. 変更対象の使用箇所を確認
grep -r "変更対象名" frontend/src --include="*.tsx" --include="*.ts"

# 2. 型定義の依存関係を確認
grep -r "extends.*変更対象型" frontend/src/types

# 3. インポート文を確認
grep -r "import.*変更対象" frontend/src
```

### 2.2 変更後チェックリスト
- [ ] TypeScriptのコンパイルエラーがないか確認
- [ ] 関連する全てのページが正常に動作するか確認
- [ ] コンソールにエラーが出ていないか確認
- [ ] APIレスポンスが期待通りか確認

## 3. 具体例

### 3.1 categoryServiceの変更例（今回のケース）
```typescript
// 変更前
async getCategories(): Promise<CategoryWithStats[]>

// 変更後
async getCategories(): Promise<{ categories: CategoryWithStats[] }>
```

**必要な修正箇所**：
1. `/pages/Categories/index.tsx` - カテゴリ管理ページ
2. `/pages/RecurringTransactions/AddRecurringTransaction.tsx` - 定期取引追加ページ
3. `/components/transaction/TransactionForm.tsx` - 取引フォーム（もし使用していれば）
4. その他カテゴリ一覧を取得している全ての箇所

### 3.2 修正時のコミットメッセージ
```
fix: カテゴリサービスのレスポンス形式を統一

- getCategories()の返り値を{ categories: CategoryWithStats[] }に変更
- 影響箇所：
  - Categories/index.tsx
  - RecurringTransactions/AddRecurringTransaction.tsx
  - [その他の影響箇所]
```

## 4. 予防策

### 4.1 型安全性の確保
- APIレスポンスの型は明示的に定義する
- `any`型の使用を避ける
- 返り値の型は必ず指定する

### 4.2 一貫性の保持
- 同じような機能は同じパターンで実装する
- 命名規則を統一する
- レスポンス形式を統一する（配列 or オブジェクト）

### 4.3 ドキュメント化
- 大きな変更を行う場合は、影響範囲をコメントに記載
- 破壊的変更の場合は、移行ガイドを作成

## 5. チーム開発時の注意事項

### 5.1 レビュー時の確認項目
- [ ] 影響調査は実施されているか
- [ ] 全ての影響箇所が修正されているか
- [ ] テストは追加/修正されているか
- [ ] ドキュメントは更新されているか

### 5.2 コミュニケーション
- 破壊的変更を行う場合は、事前にチームに共有
- 影響範囲が大きい場合は、段階的な移行を検討
- 修正漏れを発見した場合は、即座に修正

---

このルールは随時更新し、チーム全体で共有すること。